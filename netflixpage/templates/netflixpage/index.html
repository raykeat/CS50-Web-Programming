
{% extends 'netflixpage/layout.html' %}
{% load static %}

{% block content %}
    <!--Home page content-->
    <div>
    <h1 class="text-4xl font-bold mb-4">Welcome to Netflix Clone!</h1>
    {% if user.is_authenticated %}
    <h8>Logged in as {{user.username}}</h8>
    {% endif %}
    </div>
    
    <!--Unlimited Films, TV Programs and More first section-->
    <div id="div1" class="relative mx-auto mb-4">
        <img class="rounded-lg opacity-50" height="700" width="1100" src="{% static 'netflixpage/netflix-reuse-official.jpg' %}">
        <h1 class="absolute top-1/2 left-20 text-left font-bold" style="color: white; font-size: 3rem; margin-top: -10rem;">Unlimited Films, TV Programmes and More!</h1>
        <h2 class="absolute top-1/2 left-20 text-left " style="color: white; font-size: 2rem; margin-top: -2rem;">Watch anywhere. Cancel anytime.</h2>
        <form action="{% url 'register' %}" id="emailform" class="absolute top-1/2 left-20 text-left" style="margin-top: +2rem;">
            {% csrf_token %}
            <input name="email" style="width: 300px; height:60px; text-indent:5px;" class="rounded-lg opacity-75 bg-black text-white text-bold" type="text" placeholder="Email Address" placeholderStyle="color: white;">
            <input style="height:45px; background-color: #FF0000; color: white; font-weight:bold;" type="submit" value="Get Started" class="btn btn-danger">
        </form>
    </div>


    <div id="app"></div>
    

    <script type="text/babel">
        
        //Enjoy on your TV and Watch Everywhere Second and Third Sections
        function Div(){

        const [animation1Visible, setAnimation1Visible] = React.useState(false);
        const [animation2Visible, setAnimation2Visible] = React.useState(false);

        React.useEffect(() => {
        const observerOptions = {
            root: null, // Use the viewport as the root element
            threshold: 0.2, // Set the threshold for when the element is considered visible
        };

        // Create a new Intersection Observer
        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
            if (entry.isIntersecting) {
                // Set the corresponding state to trigger the animation
                if (entry.target.id === "div1") {
                setAnimation1Visible(true);
                } else if (entry.target.id === "div2") {
                setAnimation2Visible(true);
                }
            }
            });
        }, observerOptions);

        // Observe the target elements
        observer.observe(document.getElementById("div1"));
        observer.observe(document.getElementById("div2"));

        // Clean up the observer when the component is unmounted
        return () => {
            observer.disconnect();
        };
        }, []);

        return (
            <div>
            <div id="div1" className= "container mx-auto px-4 py-8 flex">
                <div>
                    <h1 className="Enjoytv-h1">Enjoy on your TV</h1>
                    <h4>Watch on smart TVs, PlayStation, Xbox, Chromecast, Apple TV, Blu-ray players and more.</h4>
                </div>
                <div>
                    <img className={`${animation1Visible ? "animate-growimage" : ""}`} id="image2" height = "600" width = "600" src="{% static 'netflixpage/Screenshot (625).png' %}"></img>
                </div>
                
            </div>

            <div id="div2" className= "container mx-auto px-4 py-8 flex">
                <div>
                    <img className={`${animation2Visible ? "animate-growimage" : ""}`} id="image2" height = "600" width = "600" src="{% static 'netflixpage/Screenshot (629).png' %}"></img>
                </div>
                <div>
                    <h1 className="Enjoytv-h1">Watch Everywhere</h1>
                    <h4>Stream unlimited films and TV programmes on your phone, tablet, laptop and TV.</h4>
                </div>
            </div>
            </div>
        )}

        //not included in actual CS50 Project submission
        function Moviecard(){

            const [hoveranimation, sethoveranimation] = React.useState(null);

            function MouseEnter(event){
                sethoveranimation(event.currentTarget.dataset.card);
                document.querySelectorAll('.moviecard').forEach((card) =>{
                    if (card === event.currentTarget){
                        card.style.opacity = '1';
                        
                    } else{
                        card.style.opacity = '0.25';
                    }
                })
            }

            function MouseLeave(event){
                sethoveranimation(null);
                document.querySelectorAll('.moviecard').forEach((card) =>{
                    card.style.opacity = '1';
                })
            }

            return(
                <div className="moviecardcontainer">
                    <div className="moviecardlist">
                        <div className={` moviecard ${hoveranimation==='card1' ? "animationhover" : ""}`} onMouseEnter={MouseEnter} onMouseLeave={MouseLeave} data-card="card1">
                            <img height="250" width="250" src="{% static 'netflixpage/Get_Out_poster.png' %}"></img>
                            <h5 id="text">Get Out</h5>
                        </div>
                        <div className={` moviecard ${hoveranimation==='card2' ? "animationhover" : ""}`} onMouseEnter={MouseEnter} onMouseLeave={MouseLeave} data-card="card2">
                            <img height="300" width="300" src="{% static 'netflixpage/50-Shades-of-Grey-2.webp' %}"></img>
                            <h5 id="text">Fifty Shades of Grey</h5>
                        </div>
                        <div className={` moviecard ${hoveranimation==='card3' ? "animationhover" : ""}`} onMouseEnter={MouseEnter} onMouseLeave={MouseLeave} data-card="card3">
                            <img height="300" width="300" src="{% static 'netflixpage/pee.jpg' %}"></img>
                            <h5 id="text">Taken 2</h5>
                        </div>
                        <div className={` moviecard ${hoveranimation==='card4' ? "animationhover" : ""}`} onMouseEnter={MouseEnter} onMouseLeave={MouseLeave} data-card="card4">
                            <img height="500" width="500" src="{% static 'netflixpage/alexandra-daddario.jpg' %}"></img>
                            <h5 id="text">Alexandra Daddario</h5>
                        </div>
                        <div className={` moviecard ${hoveranimation==='card5' ? "animationhover" : ""}`} onMouseEnter={MouseEnter} onMouseLeave={MouseLeave} data-card="card5">
                            <img height="500" width="500" src="{% static 'netflixpage/alexandra-daddario-nude-sequence.jpg' %}"></img>
                            <h5 id="text">Alexandra Daddario</h5>
                        </div>
                    </div>
                </div>
            )
        }

        //Movie Cards with real time movie data Fourth Section (horror)
        function Moviecard2(){
            const [moviedata, setmoviedata] = React.useState([]);

            React.useEffect(() => {
                //fetch request to Django backend to dynamically retrieve real time movie data
                fetch('/retrievemovie/homepage/')
                .then((response) => response.json())
                .then((data) => {
                    setmoviedata(data);
                    console.log(data);
                })
                .catch((error) => {
                    console.error('Error fetching movie data: ', error);
                });
            },[]) //empty dependency array to prevent use effect from running infinitely lol

            function closecard(movieid) {
                console.log(movieid);
                document.getElementById(movieid).style.display = 'none';
                document.getElementById(`overlay-${movieid}`).style.display = 'none';
            }

            function showcard(movieid) {
                console.log(movieid);
                document.getElementById(movieid).style.display = 'block';
                document.getElementById(`overlay-${movieid}`).style.display = 'block';
            }

            function getcookie() {
                const cookieValue = document.cookie
                .split('; ')
                .find(row => row.startsWith('csrftoken='))
                .split('=')[1];
                return cookieValue;
            }

            //react function to update text displayed in like/unlike button after its been clicked
            function handlelike(movieid,likebuttonmessage) {
                const csrftoken = getcookie();
                axios.post(`/like/${movieid}/${likebuttonmessage}/`,{},{
                    headers: {
                        'X-CSRFToken': csrftoken,
                    }
                })
                .then((response) => {
                    //document.queryselector is not recommended to update text content of button,
                    //instead should update state of movie data array
                    const updatedmessage = response.data.liked_message

                    setmoviedata((prevData)=>{
                        const updatedmovies = prevData.map((movie)=>{

                            //if movie is the movie for which we clicked like button
                            if (movie.movieid === movieid){
                                //spread syntax { ...movie } copies all the properties 
                                //of current movie object into a new movie object,
                                //liked_button_message: updatedmessage updates the message
                                return {...movie, liked_button_message: updatedmessage };
                            } else{
                                return movie;
                            }
                        })
                        return updatedmovies;
                    })
                })
                .catch((error) => {
                    console.error('Error liking movie: ', error);
                });
            }

            //react function to update watchlist button after its been clicked
            function handle_watchlist(movieid,watchlist_message) {
                const csrftoken = getcookie();
                axios.post(`/watchlist/${movieid}/${watchlist_message}/`,{},{
                    headers: {
                        'X-CSRFToken': csrftoken,
                    }
                })
                .then((response) => {
                    //document.queryselector is not recommended to update text content of button,
                    //instead should update state of movie data array
                    const updatedmessage = response.data.watchlist_message;
                    const updatedclass = response.data.watchlist_class;

                    setmoviedata((prevData)=>{
                        const updatedmovies = prevData.map((movie)=>{

                            //if movie is the movie for which we clicked watchlist button
                            if (movie.movieid === movieid){
                                //spread syntax { ...movie } copies all the properties 
                                //of current movie object into a new movie object,
                                //watchlist_message: updatedmessage updates the message
                                return {...movie, watchlist_message: updatedmessage, watchlist_class: updatedclass };
                            } else{
                                return movie;
                            }
                        })
                        return updatedmovies;
                    })
                })
                .catch((error) => {
                    console.error('Error updating watchlist: ', error);
                });
            }

            return (
                <div>
                <h4 className="genre-category">Horror Films</h4>

                <div className="movie-card-container">
                {moviedata.map((movie) => (
                    
                    <div className="movie-card"
                    onMouseEnter={()=>showcard(movie.movieid)}
                    onMouseLeave={()=>closecard(movie.movieid)}
                    >

                        <div className="movie-image">
                            <img className="movie-image-img" height="200" width="250" src={movie.posterpath}></img>
                        </div>

                        
                        <div id={movie.movieid} className='movie-details'>
                            <div className="close-button-container">
                            {/* ()=>closecard(movie.movieid) creates a new function that calls closecard function when invoked*/}
                            <button className="close-button" onClick={()=>closecard(movie.movieid)}>X</button>
                            </div>

                            <img height="250" width="250" src={movie.posterpath}></img>
                            <iframe width="560" height="315" src={movie.embed_url} frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>

                            <a className={`likebutton-${movie.movieid}`} onClick={() => handlelike(movie.movieid, movie.liked_button_message)} class="btn btn-info btn-lg">
                                <span class="glyphicon glyphicon-thumbs-up"></span> {movie.liked_button_message}
                            </a>
                            <a className="watchlistbutton" onClick={() => handle_watchlist(movie.movieid, movie.watchlist_message)} class="btn btn-info btn-lg">
                                <span class={`${movie.watchlist_class}`}></span> {movie.watchlist_message}
                            </a>
                            <h5>Title: {movie.title}</h5>
                            <h5>Movie ID: {movie.movieid}</h5>
                            <h5>Rating: {movie.rating}</h5>
                            <h5>Release date: {movie.releasedate}</h5>
                            <h5>Genres: {movie.genres}</h5>
                            <p>Summary: {movie.overview}</p>
                        </div>
                        

                        {/*to add effect of darkening other areas of screen when movie details of a movie is shown*/}
                        <div id={`overlay-${movie.movieid}`} className = "movie-details-overlay"></div>
                    
                    </div>
                ))}
                </div>
                </div>
            );
        }
        
        
        ReactDOM.render(
        <div>
            <div>
                <Div />
            </div>
            <div>
                <Moviecard />
            </div>
            <div>
                <Moviecard2 />
            </div>
        </div>
        ,document.querySelector('#app'));
    
    
    document.querySelectorAll('.moviecard').forEach((card) =>{
        card.addEventListener('onMouseEnter',MouseEnter)
    })
    
    </script>

    
    <style>
        /*CSS for Movie Cards with real time movie data Fourth Section*/
        .genre-category{
            color: white;
            margin-top: 50px;
            margin-bottom: 10px;
        }

        .movie-card-container {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: scroll;
        justify-content: flex-start;
        }

        .movie-card {
        position: relative;
        flex: 0 0 auto;
        width: 135px;
        height: 225px;
        margin-right: 10px;
        cursor: pointer;
        }

        .movie-image {
        position: relative;
        border-radius: 30px;
        }

        .movie-image-img {
            border-radius: 5px;
        }

        .movie-card:hover .movie-details {
        display: block;
        }

        .movie-card:hover .movie-details-overlay{
            display:block;
        }

        .movie-details-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        z-index: 5;
        display: none;
        }

        .movie-details {
        position: fixed;
        top: 57%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        max-width: 800px;
        height: 80%;
        max-height: 600px;
        background-color: #201f1f;
        color: white;
        padding: 20px;
        z-index: 9999;
        display: none;
        overflow: auto;
        border-radius: 30px;
        }

        .movie-details img {
        width: 400px;
        height: 500px;
        margin-bottom: 10px;
        display: block; 
        margin-left: auto; 
        margin-right: auto; 
        }

        .movie-details h5,
        .movie-details p {
        margin: 5px 0;
        }

        .likebutton {
            margin-right: 20px;
        }
        .close-button{
            position:absolute;
        }

        .watchlistbutton{
            margin: 30px;
        }

        



        iframe{
            margin: auto;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        



 

        /*CSS for Static Movie Cards Section*/
        .moviecardcontainer{
            overflow-x: scroll;
        }
        .moviecardlist {
        display: flex;
        flex-direction: row;
        align-items: center;
        text-align: center;
        }

        .moviecard{
            flex: 0 0 auto;
            margin-right: 10px;
        }

        @keyframes grow {
            0% {
                transform: scale(1);
            }
            100% {
                transform: scale(1.5);
            }
            }

        .animationhover{
            animation-name: grow;
            animation-duration: 4s;
            animation-fill-mode: forwards;
        }

    </style>

{% endblock %}
